---
- name: "register {{ mbpayments.dirs.production }} chroot dir"
  set_fact: chroot_dir="{{ billing.dirs.home }}/{{ mbpayments.dirs.module }}/{{ mbpayments.dirs.chroot }}/{{ mbpayments.dirs.production }}"

- name: "mount {{ billing.dirs.home }}/{{ mbpayments.dirs.module }}/{{ mbpayments.dirs.production }}/public -> {{ chroot_dir }}{{ mbpayments.dirs.www }}/{{ mbpayments.dirs.module }}"
  blockinfile:
    path: "/etc/fstab"
    block: |
      # www
      {{ billing.dirs.home }}/{{ mbpayments.dirs.module }}/{{ mbpayments.dirs.production }}/public {{ chroot_dir }}{{ mbpayments.dirs.www }}/{{ mbpayments.dirs.module }} none defaults,bind 0 0
      # config
      {{ billing.dirs.home }}/{{ mbpayments.dirs.module }}/{{ mbpayments.dirs.production }}/config {{ chroot_dir }}{{ billing.dirs.home }}/config none defaults,bind 0 0
      # logs
      {{ billing.dirs.home }}/{{ billing.dirs.logs }}/{{ mbpayments.dirs.module }} {{ chroot_dir }}{{ billing.dirs.home }}/{{ billing.dirs.logs }} none defaults,bind 0 0
    marker: "# {mark} {{ mbpayments.dirs.module }} {{ mbpayments.dirs.production }}"

- name: "register {{ mbpayments.dirs.testing }} chroot dir"
  set_fact: chroot_dir="{{ billing.dirs.home }}/{{ mbpayments.dirs.module }}/{{ mbpayments.dirs.chroot }}/{{ mbpayments.dirs.testing }}"

- name: "mount {{ billing.dirs.home }}/{{ mbpayments.dirs.module }}/{{ mbpayments.dirs.testing }}/public -> {{ chroot_dir }}{{ mbpayments.dirs.www }}/{{ mbpayments.dirs.module }}"
  blockinfile:
    path: "/etc/fstab"
    block: |
      # www
      {{ billing.dirs.home }}/{{ mbpayments.dirs.module }}/{{ mbpayments.dirs.testing }}/public {{ chroot_dir }}{{ mbpayments.dirs.www }}/{{ mbpayments.dirs.module }} none defaults,bind 0 0
      # config
      {{ billing.dirs.home }}/{{ mbpayments.dirs.module }}/{{ mbpayments.dirs.testing }}/config {{ chroot_dir }}{{ billing.dirs.home }}/config none defaults,bind 0 0
      # logs
      {{ billing.dirs.home }}/{{ billing.dirs.logs }}/{{ mbpayments.dirs.module }} {{ chroot_dir }}{{ billing.dirs.home }}/{{ billing.dirs.logs }} none defaults,bind 0 0
    marker: "# {mark} {{ mbpayments.dirs.module }} {{ mbpayments.dirs.testing }}"

- name: "re-mount"
  command: "mount -a"
  args:
    warn: no
